{"version":3,"sources":["xhr.js"],"names":["window","require","isFunction","parseHeaders","xtend","module","exports","createXHR","XMLHttpRequest","noop","XDomainRequest","forEachArray","method","uri","options","callback","initParams","toUpperCase","_createXHR","array","iterator","i","length","isEmpty","obj","hasOwnProperty","params","Error","called","cbOnce","err","response","body","readystatechange","xhr","readyState","setTimeout","loadFunc","getBody","undefined","responseText","getXml","isJson","JSON","parse","e","errorFunc","evt","clearTimeout","timeoutTimer","statusCode","failureResponse","aborted","status","useXDR","headers","url","rawRequest","getAllResponseHeaders","cors","key","data","sync","json","onreadystatechange","onload","onerror","onprogress","onabort","ontimeout","open","username","password","withCredentials","timeout","abort","code","setRequestHeader","responseType","beforeSend","send","responseXML","firefoxBugTakenEffect","documentElement","nodeName"],"mappings":"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","file":"xhr.js","sourcesContent":["/*!\n * Copyright (c) 2015-2017 Cisco Systems, Inc. See LICENSE file.\n */\n\n// Need to fork xhr to support environments with full object freezing; namely,\n// SalesForce's Aura and Locker environment.\n\n// See https://github.com/naugtur/xhr for license information\n\n// Maintain the original code style of https://github.com/naugtur/xhr since\n// we're trying to diverge as little as possible.\n/* eslint-disable */\n\n\"use strict\";\nvar window = require(\"global/window\")\nvar isFunction = require(\"is-function\")\nvar parseHeaders = require(\"parse-headers\")\nvar xtend = require(\"xtend\")\n\nmodule.exports = createXHR\ncreateXHR.XMLHttpRequest = window.XMLHttpRequest || noop\ncreateXHR.XDomainRequest = \"withCredentials\" in (new createXHR.XMLHttpRequest()) ? createXHR.XMLHttpRequest : window.XDomainRequest\n\nforEachArray([\"get\", \"put\", \"post\", \"patch\", \"head\", \"delete\"], function(method) {\n    createXHR[method === \"delete\" ? \"del\" : method] = function(uri, options, callback) {\n        options = initParams(uri, options, callback)\n        options.method = method.toUpperCase()\n        return _createXHR(options)\n    }\n})\n\nfunction forEachArray(array, iterator) {\n    for (var i = 0; i < array.length; i+= 1) {\n        iterator(array[i])\n    }\n}\n\nfunction isEmpty(obj){\n    for(var i in obj){\n        if(obj.hasOwnProperty(i)) return false\n    }\n    return true\n}\n\nfunction initParams(uri, options, callback) {\n    var params = uri\n\n    if (isFunction(options)) {\n        callback = options\n        if (typeof uri === \"string\") {\n            params = {uri:uri}\n        }\n    } else {\n        params = xtend(options, {uri: uri})\n    }\n\n    params.callback = callback\n    return params\n}\n\nfunction createXHR(uri, options, callback) {\n    options = initParams(uri, options, callback)\n    return _createXHR(options)\n}\n\nfunction _createXHR(options) {\n    if(typeof options.callback === \"undefined\"){\n        throw new Error(\"callback argument missing\")\n    }\n\n    var called = false\n    var callback = function cbOnce(err, response, body){\n        if(!called){\n            called = true\n            options.callback(err, response, body)\n        }\n    }\n\n    function readystatechange() {\n        if (xhr.readyState === 4) {\n            setTimeout(loadFunc, 0)\n        }\n    }\n\n    function getBody() {\n        // Chrome with requestType=blob throws errors arround when even testing access to responseText\n        var body = undefined\n\n        if (xhr.response) {\n            body = xhr.response\n        } else {\n            body = xhr.responseText || getXml(xhr)\n        }\n\n        if (isJson) {\n            try {\n                body = JSON.parse(body)\n            } catch (e) {}\n        }\n\n        return body\n    }\n\n    function errorFunc(evt) {\n        clearTimeout(timeoutTimer)\n        if(!(evt instanceof Error)){\n            evt = new Error(\"\" + (evt || \"Unknown XMLHttpRequest Error\") )\n        }\n        evt.statusCode = 0\n        return callback(evt, failureResponse)\n    }\n\n    // will load the data & process the response in a special response object\n    function loadFunc() {\n        if (aborted) return\n        var status\n        clearTimeout(timeoutTimer)\n        if(options.useXDR && xhr.status===undefined) {\n            //IE8 CORS GET successful response doesn't have a status field, but body is fine\n            status = 200\n        } else {\n            status = (xhr.status === 1223 ? 204 : xhr.status)\n        }\n        var response = failureResponse\n        var err = null\n\n        if (status !== 0){\n            response = {\n                body: getBody(),\n                statusCode: status,\n                method: method,\n                headers: {},\n                url: uri,\n                rawRequest: xhr\n            }\n            if(xhr.getAllResponseHeaders){ //remember xhr can in fact be XDR for CORS in IE\n                response.headers = parseHeaders(xhr.getAllResponseHeaders())\n            }\n        } else {\n            err = new Error(\"Internal XMLHttpRequest Error\")\n        }\n        return callback(err, response, response.body)\n    }\n\n    var xhr = options.xhr || null\n\n    if (!xhr) {\n        if (options.cors || options.useXDR) {\n            xhr = new createXHR.XDomainRequest()\n        }else{\n            xhr = new createXHR.XMLHttpRequest()\n        }\n    }\n\n    var key\n    var aborted\n    var uri = options.uri || options.url\n    var method = options.method || \"GET\"\n    var body = options.body || options.data\n    var headers = options.headers || {}\n    var sync = !!options.sync\n    var isJson = false\n    var timeoutTimer\n    var failureResponse = {\n        body: undefined,\n        headers: {},\n        statusCode: 0,\n        method: method,\n        url: uri,\n        rawRequest: xhr\n    }\n\n    if (\"json\" in options && options.json !== false) {\n        isJson = true\n        headers[\"accept\"] || headers[\"Accept\"] || (headers[\"Accept\"] = \"application/json\") //Don't override existing accept header declared by user\n        if (method !== \"GET\" && method !== \"HEAD\") {\n            headers[\"content-type\"] || headers[\"Content-Type\"] || (headers[\"Content-Type\"] = \"application/json\") //Don't override existing accept header declared by user\n            body = JSON.stringify(options.json === true ? body : options.json)\n        }\n    }\n\n    xhr.onreadystatechange = readystatechange\n    xhr.onload = loadFunc\n    xhr.onerror = errorFunc\n    // IE9 must have onprogress be set to a unique function.\n    xhr.onprogress = function () {\n        // IE must die\n    }\n    xhr.onabort = function(){\n        aborted = true;\n    }\n    xhr.ontimeout = errorFunc\n    xhr.open(method, uri, !sync, options.username, options.password)\n    //has to be after open\n    if(!sync) {\n        xhr.withCredentials = !!options.withCredentials\n    }\n    // Cannot set timeout with sync request\n    // not setting timeout on the xhr object, because of old webkits etc. not handling that correctly\n    // both npm's request and jquery 1.x use this kind of timeout, so this is being consistent\n    if (!sync && options.timeout > 0 ) {\n        timeoutTimer = setTimeout(function(){\n            if (aborted) return\n            aborted = true//IE9 may still call readystatechange\n            xhr.abort(\"timeout\")\n            var e = new Error(\"XMLHttpRequest timeout\")\n            e.code = \"ETIMEDOUT\"\n            errorFunc(e)\n        }, options.timeout )\n    }\n\n    if (xhr.setRequestHeader) {\n        for(key in headers){\n            if(headers.hasOwnProperty(key)){\n                xhr.setRequestHeader(key, headers[key])\n            }\n        }\n    } else if (options.headers && !isEmpty(options.headers)) {\n        throw new Error(\"Headers cannot be set on an XDomainRequest object\")\n    }\n\n    if (\"responseType\" in options) {\n        xhr.responseType = options.responseType\n    }\n\n    if (\"beforeSend\" in options &&\n        typeof options.beforeSend === \"function\"\n    ) {\n        options.beforeSend(xhr)\n    }\n\n    // Microsoft Edge browser sends \"undefined\" when send is called with undefined value.\n    // XMLHttpRequest spec says to pass null as body to indicate no body\n    // See https://github.com/naugtur/xhr/issues/100.\n    xhr.send(body || null)\n\n    return xhr\n\n\n}\n\nfunction getXml(xhr) {\n    if (xhr.responseType === \"document\") {\n        return xhr.responseXML\n    }\n    var firefoxBugTakenEffect = xhr.responseXML && xhr.responseXML.documentElement.nodeName === \"parsererror\"\n    if (xhr.responseType === \"\" && !firefoxBugTakenEffect) {\n        return xhr.responseXML\n    }\n\n    return null\n}\n\nfunction noop() {}\n"]}